---
sidebar:
nav: "main"
layout: single
title:  "효율적인 코드리뷰를 위한 PR과 commit 관리"
categories: [git]
tags: [git, pr, code-review]
teaser: /assets/images/teaser/java.jpeg
---

<p align="center"><img src="/assets/images/teaser/git.png" width="100%" height="auto"></p>

이번 포스팅은 효율적인 코드리뷰를 위한 PR관리와 커밋관리입니다.\
여러 코드리뷰 툴이 있는 것으로 알고있지만 해당 포스팅에선 github을 기준으로 설명합니다.\
git툴은 인텔리제이를 기준으로 설명합니다.

먼저 글에 들어가기 앞서 왜 코드리뷰를 위해 커밋을 쪼개고 PR을 나눠서 해야할까요?\
이유는 간단합니다. 리뷰어가 좀 더 적은 File change(이하 파일리스트) 를 확인하게 하여 리뷰어의 피로감을 줄이고
코드리뷰시 좀 더 집중하기 편하게 하기 위해서입니다.\
예를들어 파일 20개짜리가 한번에 코드리뷰가 올라온다고 생각하여보세요.\
한 두번이야 괜찮지만 매번 코드리뷰가 10~20개의 파일을 전부 확인하면서 해야한다면 리뷰하는 입장에서 굉장히 괴롭습니다.\
(한 시니어 개발자분께선 이런 코드리뷰요청은 직장폭력으로 규정해야 한다네요 ㅎ)\
하지만 프로젝트 처음 시작후 기능을 붙히는 경우이거나 아예 너무나도 다른기능을 프로젝트에 시작해야해서 등등 여러의 이유로 파일이 많이 생길 수 있습니다.\
그럴때 과연 어떻게 해야할까요?

가장 간단한 방법은 _*작업을 최대한 쪼갠다.*_ 입니다.\
(해당 글은 git을 다루는 내용이기에 이부분을 깊게 다루진 않겠습니다.)\
그러나 이방법이 모든 해결은 아닙니다. 어쩔수 없이 File이 굉장히 많이 쌓일때가 있습니다.\
이제 그럴경우 어떻게 해야할까요?

---

<p align="center"><img src="/assets/images/posts/20220508/log.png" width="100%" height="auto"></p>
다음과 같은 커밋리스트를 다시한번 쪼갠 후 커밋단위를 묶을 생각입니다.

먼저 제일 바탕이 되는 git의 커밋시점으로 롤백합니다.\
저는 맨아래커밋인 'api isEnd시 까지 긁어오기 완료'를 기준으로 리셋하겠습니다.\
주의해야할 점은 soft reset를 사용하여야 합니다.
<p align="center"><img src="/assets/images/posts/20220508/reset.png" width="100%" height="auto"></p>
<p align="center"><img src="/assets/images/posts/20220508/filelist.png" width="100%" height="auto"></p>
소프트 리셋후 보시면 여태 커밋한 파일들이 change list에 있는것을 확인 하실수 있습니다.\
커밋을 다음과 같은 기준으로 묶습니다.

1. 코드리뷰가 필요한 파일과 불필요한 파일을 구분합니다
  - 이미지,테스트코드를 위한 데이터파일 등 리소스폴더의 파일의 경우 굳이 세세한 코드리뷰가 필요하지 않는 경우가 많습니다. 빌드에 영향을 안주는 경우도 많죠.
  - 이럴땐 커밋을 분리하여 따로 PR을 생성하여 바로 머지후 진행하면 됩니다.
2. 구현코드를 먼저 커밋하고 테스트코드를 추후 커밋하여 구현 - 테스트를 분리합니다.
  - 개발은 TDD로 하여도 코드리뷰를 위해 구현과 테스트코드를 분리하는 방법입니다.\
    코드리뷰할때는 테스트코드가 꼭 필요없죠 코드리뷰시점에서는 테스트코드를 꼭 먼저 리뷰할 필요는 없습니다.


<p align="center"><img src="/assets/images/posts/20220508/result.png" width="100%" height="auto"></p>

34개의 파일을 각자의 기능별로 묶어서 파일을 커밋을 나누었습니다.\
나누어진 커밋을 하나씩 PR을 날려 병합하면서 코드리뷰를 진행하면됩니다.\
생각보다 간단하쥬?

이런 방식으로 코드리뷰를 하면 리뷰어 입장에선 굉장히 편리합니다. 코드리뷰에 피로감도 줄어드는 장점도 있구요.\
작업을 진행하는 요청자 입장에선 조금 귀찮다 생각 할 순 있지만\
오히려 이후에 PR을 생각안하고 개발시엔 편하게 커밋과 롤백을 하며 개발 후 마지막에 커밋을 정리되서 오히려 편리합니다.
